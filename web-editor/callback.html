<script>
    const params = new URLSearchParams(window.location.search);
    const code = params.get('code');
    const state = params.get('state');

    console.log('授权码 (code):', code);  // 调试用，查看 code 参数
    console.log('状态码 (state):', state);  // 调试用，查看 state 参数

    if (code) {
        fetch('https://github.com/login/oauth/access_token', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            },
            body: JSON.stringify({
                client_id: 'Ov23ligWR1OA4D8xEHN4',  // 你的 Client ID
                client_secret: '85babf4aed3d705c7aa51ec65fbc6a5989d91f92',  // 你的 Client Secret
                code: code,
                redirect_uri: 'https://hafrey1.github.io/LunaTV-config/web-editor/callback.html',
                state: state
            })
        })
        .then(response => response.json())
        .then(data => {
            console.log('GitHub 授权返回数据:', data);  // 调试用，查看 GitHub 返回的数据
            const token = data.access_token;
            if (token) {
                localStorage.setItem('github_token', token);
                window.location.href = 'https://hafrey1.github.io/LunaTV-config/web-editor';
            } else {
                alert('授权失败！');
            }
        })
        .catch(error => {
            console.error('OAuth 错误:', error);
            alert('授权失败！');
        });
    } else {
        alert('未找到授权码。');
    }
</script>
