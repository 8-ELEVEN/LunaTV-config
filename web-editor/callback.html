<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>GitHub OAuth 回调</title>
</head>
<body>
<p>授权成功，正在跳转...</p>
<script>
    const CLIENT_ID = 'Ov23ligWR1OA4D8xEHN4';
    const CLIENT_SECRET = '85babf4aed3d705c7aa51ec65fbc6a5989d91f92';
    const REDIRECT_BACK = 'https://hafrey1.github.io/LunaTV-config/web-editor/'; // 回跳到主编辑页面

    // 获取 URL 中的授权码
    const code = new URLSearchParams(window.location.search).get('code');
    if (!code) {
        alert('未获取到授权码');
    } else {
        // 打印授权码，用于调试
        console.log('GitHub授权码:', code);

        // 使用授权码请求 access token
        fetch('https://cors-anywhere.herokuapp.com/https://github.com/login/oauth/access_token', {
            method: 'POST',
            headers: { 'Accept': 'application/json', 'Content-Type': 'application/json' },
            body: JSON.stringify({ client_id: CLIENT_ID, client_secret: CLIENT_SECRET, code })
        })
        .then(r => r.json())
        .then(data => {
            console.log('GitHub Access Token Response:', data);
            if (data.access_token) {
                localStorage.setItem('access_token', data.access_token); // 存储 Access Token
                window.location.href = REDIRECT_BACK; // 跳回到主页面
            } else {
                alert('获取 Access Token 失败，请重试！');
            }
        })
        .catch(err => {
            console.error('获取 Access Token 失败:', err);
            alert('发生错误，请重试！');
        });
    }
</script>
</body>
</html>
